{"version":3,"sources":["downloader-audio.js"],"names":["i18n","require","cc","Class","extends","Component","properties","remindLabel","default","type","Label","inputUrlBox","EditBox","_audioPlayer","_audioUrl","onLoad","textKey","node","getComponent","startLoad","string","loader","load","url","onProgress","bind","audioLoadComplete","t","err","res","console","log","setAudioTask","completedCount","totalCount","update","currentTime","onDisable","stopAllAudio"],"mappings":";;;;;;AAAA,IAAMA,OAAOC,QAAQ,MAAR,CAAb;;AAEAC,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,qBAAa;AACTC,qBAAS,IADA;AAETC,kBAAMP,GAAGQ;AAFA,SADL;AAKRC,qBAAa;AACTH,qBAAS,IADA;AAETC,kBAAMP,GAAGU;AAFA,SALL;AASRC,sBAAc,IATN;AAURC,mBAAW;AAVH,KAHP;;AAgBLC,UAhBK,oBAgBK;AACN,aAAKR,WAAL,CAAiBS,OAAjB,GAA2B,EAA3B;AACA,aAAKH,YAAL,GAAoB,KAAKI,IAAL,CAAUC,YAAV,CAAuB,WAAvB,CAApB;AACH,KAnBI;AAqBLC,aArBK,uBAqBQ;AACT;AACA,aAAKL,SAAL,GAAiB,KAAKH,WAAL,CAAiBS,MAAlC;AACA;AACA,YAAI,KAAKN,SAAT,EAAoB;AAChBZ,eAAGmB,MAAH,CAAUC,IAAV,CAAe,EAACC,KAAK,KAAKT,SAAX,EAAsBL,MAAM,KAA5B,EAAf,EAAmD,KAAKe,UAAL,CAAgBC,IAAhB,CAAqB,IAArB,CAAnD,EAA+E,KAAKC,iBAAL,CAAuBD,IAAvB,CAA4B,IAA5B,CAA/E;AACA,iBAAKlB,WAAL,CAAiBS,OAAjB,GAA2BhB,KAAK2B,CAAL,CAAO,mDAAP,CAA3B;AACH,SAHD,MAIK;AACD,iBAAKpB,WAAL,CAAiBS,OAAjB,GAA2BhB,KAAK2B,CAAL,CAAO,oDAAP,CAA3B;AACH;AACJ,KAhCI;AAkCLD,qBAlCK,6BAkCcE,GAlCd,EAkCmBC,GAlCnB,EAkCwB;AACzB,YAAID,OAAO,CAACC,GAAZ,EAAiB;AACbC,oBAAQC,GAAR,CAAYH,GAAZ;AACA,iBAAKrB,WAAL,CAAiBS,OAAjB,GAA4BhB,KAAK2B,CAAL,CAAO,qDAAP,CAA5B;AACA;AACH;AACD,aAAKpB,WAAL,CAAiBS,OAAjB,GAA2BhB,KAAK2B,CAAL,CAAO,qDAAP,CAA3B;AACA;AACA,aAAKd,YAAL,CAAkBmB,YAAlB,CAA+BH,GAA/B;AACH,KA3CI;AA6CLL,cA7CK,sBA6COS,cA7CP,EA6CuBC,UA7CvB,EA6CmC;AACpC,aAAK3B,WAAL,CAAiBS,OAAjB,GAA8BhB,KAAK2B,CAAL,CAAO,mDAAP,CAA9B,SAA8FM,iBAAeC,UAAhB,GAA8B,GAA3H;AACH,KA/CI;AAiDLC,UAjDK,oBAiDK;AACN,aAAKtB,YAAL,CAAkBuB,WAAlB;AACH,KAnDI;AAqDLC,aArDK,uBAqDO;AACR,aAAKxB,YAAL,CAAkByB,YAAlB;AACH;AAvDI,CAAT","file":"downloader-audio.js","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\cases\\05_scripting\\11_network\\downloader-web","sourcesContent":["const i18n = require('i18n');\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        remindLabel: {\n            default: null,\n            type: cc.Label\n        },\n        inputUrlBox: {\n            default: null,\n            type: cc.EditBox\n        },\n        _audioPlayer: null,\n        _audioUrl: 'http://tools.itharbors.com/christmas/res/sounds/ss.mp3',\n    },\n\n    onLoad () {\n        this.remindLabel.textKey = '';\n        this._audioPlayer = this.node.getComponent('AudioCtrl');\n    },\n\n    startLoad () {\n        // set url\n        this._audioUrl = this.inputUrlBox.string;\n        // download audio\n        if (this._audioUrl) {\n            cc.loader.load({url: this._audioUrl, type: 'mp3'}, this.onProgress.bind(this), this.audioLoadComplete.bind(this));\n            this.remindLabel.textKey = i18n.t('cases/05_scripting/11_network/download-web.fire.2');\n        }\n        else {\n            this.remindLabel.textKey = i18n.t('cases/05_scripting/11_network/download-web.fire.10');\n        }\n    },\n\n    audioLoadComplete (err, res) {\n        if (err || !res) {\n            console.log(err);\n            this.remindLabel.textKey =  i18n.t('cases/05_scripting/11_network/download-web.fire.5.1');\n            return;\n        }\n        this.remindLabel.textKey = i18n.t('cases/05_scripting/11_network/download-web.fire.4.1');\n        // return back a AudioClip\n        this._audioPlayer.setAudioTask(res);\n    },\n\n    onProgress (completedCount, totalCount) {\n        this.remindLabel.textKey = `${i18n.t('cases/05_scripting/11_network/download-web.fire.3')} ${(completedCount/totalCount) * 100}`;\n    },\n\n    update () {\n        this._audioPlayer.currentTime();\n    },\n\n    onDisable() {\n        this._audioPlayer.stopAllAudio();\n    }\n});\n"]}