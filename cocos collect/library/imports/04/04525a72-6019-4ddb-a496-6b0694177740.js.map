{"version":3,"sources":["..\\..\\..\\..\\assets\\main menu/assets\\main menu\\Menu.js"],"names":["i18n","require","SceneList","TipsManager","MainScene","cc","Class","extends","Component","properties","text","Label","readme","ScrollView","btnInfo","Button","btnBack","testList","uiCamera","Camera","sceneTitle","onLoad","_isLoadingScene","showDebugDraw","game","addPersistRootNode","node","currentSceneUrl","contentPos","active","loadInstruction","zIndex","content","sceneList","getComponent","init","cocosAnalytics","isInited","CAEvent","onEvent","eventName","systemEvent","on","SystemEvent","EventType","KEY_DOWN","event","keyCode","macro","KEY","b","back","backToList","director","Director","EVENT_AFTER_SCENE_LAUNCH","_onSceneLaunched","cameras","i","l","length","camera","cullingMask","groupIndex","loadScene","url","showReadme","getContentPosition","onLoadSceneFinish","bind","CALevels","begin","level","isMenu","endsWith","setContentPosition","string","replace","_getAdjacentScenes","res","next","prev","findAvailableScene","startIndex","step","sceneName","path","basename","available","hasSupport","some","item","index","nextScene","prevScene","self","urlArr","split","fileName","loader","loadRes","TextAsset","err","asset","t","undefined","scrollToTop","enabledDebugDraw","getCollisionManager","videoPlayer","find","restart","gc","sys","garbageCollect"],"mappings":"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","file":"Menu.js","sourceRoot":"..\\..\\..\\..\\assets\\main menu","sourcesContent":["const i18n = require('i18n');\nconst SceneList = require('SceneList');\nconst TipsManager = require('TipsManager');\n\nconst MainScene = 'TestList.fire';\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        text: cc.Label,\n        readme: cc.ScrollView,\n        btnInfo: cc.Button,\n        btnBack: cc.Button,\n        testList: cc.ScrollView,\n        uiCamera: cc.Camera,\n        sceneTitle: cc.Label,\n    },\n\n    onLoad: function () {\n        this._isLoadingScene = false;\n        this.showDebugDraw = false;\n        cc.game.addPersistRootNode(this.node);\n        this.currentSceneUrl = MainScene;\n        this.contentPos = null;\n        this.btnBack.node.active = false;\n        this.loadInstruction(this.currentSceneUrl);\n        this.node.zIndex = 999;\n\n        cc.game.addPersistRootNode(this.testList.node);\n        if (this.testList && this.testList.content) {\n            // in main scene\n            this.sceneList = this.testList.content.getComponent(SceneList);\n            this.sceneList.init(this);\n        }\n        if (typeof cocosAnalytics !== 'undefined' && cocosAnalytics.isInited && cocosAnalytics.isInited()) {\n            // Cocos Analytics service, to learn more please visit:\n            // https://analytics.cocos.com/docs/\n            cocosAnalytics.CAEvent.onEvent({\n                eventName: \"打开范例\"\n            });\n        }\n\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, (event) => {\n            if (event.keyCode === cc.macro.KEY.b || event.keyCode === cc.macro.KEY.back) {\n                this.backToList();\n            }\n        }, this);\n\n        cc.director.on(cc.Director.EVENT_AFTER_SCENE_LAUNCH, this._onSceneLaunched, this);\n    },\n\n    _onSceneLaunched () {\n        let cameras = cc.Camera.cameras;\n        for (let i = 0, l = cameras.length; i < l; i++) {\n            let camera = cameras[i];\n            if (camera === this.uiCamera) {\n                camera.cullingMask = 1 << this.node.groupIndex;\n            }\n            else {\n                camera.cullingMask = camera.cullingMask & (~(1 << this.node.groupIndex));\n            }\n        }\n    },\n\n    backToList: function () {\n        this.loadScene(MainScene);\n    },\n\n    loadScene: function (url) {\n        if (this._isLoadingScene) {\n            return;\n        }\n        this._isLoadingScene = true;\n\n        this.showReadme(null, false);\n        this.contentPos = this.testList.getContentPosition();\n\n        this.currentSceneUrl = url;\n        cc.director.loadScene(url, this.onLoadSceneFinish.bind(this));\n\n        if (typeof cocosAnalytics !== 'undefined' && cocosAnalytics.isInited && cocosAnalytics.isInited()) {\n            // Cocos Analytics service, to learn more please visit:\n            // https://analytics.cocos.com/docs/\n            cocosAnalytics.CALevels.begin({\n                level: url\n            });\n        }\n    },\n\n    onLoadSceneFinish: function () {\n        let url = this.currentSceneUrl;\n        this.loadInstruction(url);\n\n\n        this.testList.node.active = false;\n\n        let isMenu = url.endsWith(MainScene);\n        this.btnBack.node.active = this.sceneTitle.node.active = !isMenu;\n        this.testList.node.active = isMenu;\n        if (isMenu) {\n            if (this.contentPos) {\n                this.testList.setContentPosition(this.contentPos);\n            }\n        }\n        else {\n            this.sceneTitle.string = url.replace('db://assets/cases/', '');\n        }\n\n        this._isLoadingScene = false;\n    },\n\n    _getAdjacentScenes () {\n        let res = { next: '', prev: '' };\n        let sceneList = this.sceneList.sceneList;\n\n        function findAvailableScene (startIndex, step) {\n            for (var i = startIndex; 0 <= i && i < sceneList.length; i += step) {\n                let url = sceneList[i].url;\n                if (url) {\n                    let sceneName = cc.path.basename(url, '.fire');\n                    let available = TipsManager.hasSupport(sceneName, true);\n                    if (available) {\n                        return url;\n                    }\n                }\n            }\n            return MainScene;\n        }\n\n        if (this.currentSceneUrl.endsWith(MainScene)) {\n            res.next = findAvailableScene(0, 1);\n            res.prev = findAvailableScene(sceneList.length - 1, -1);\n        }\n        else {\n            // findIndex\n            let i = -1;\n            sceneList.some((item, index) => {\n                if (item.url === this.currentSceneUrl) {\n                    i = index;\n                    return true;\n                }\n                return false;\n            });\n\n            if (i !== -1) {\n                res.next = findAvailableScene(i + 1, 1);\n                res.prev = findAvailableScene(i - 1, -1);\n            }\n        }\n        return res;\n    },\n\n    nextScene () {\n        let { next } = this._getAdjacentScenes();\n        if (next) {\n            this.loadScene(next);\n        }\n    },\n\n    prevScene () {\n        let { prev } = this._getAdjacentScenes();\n        if (prev) {\n            this.loadScene(prev);\n        }\n    },\n\n    loadInstruction: function (url) {\n        let self = this;\n        let urlArr = url.split('/');\n        let fileName = urlArr[urlArr.length - 1].replace('.fire', '');\n        cc.loader.loadRes('readme/' + fileName, cc.TextAsset, function (err, asset) {\n            if (err) {\n                self.text.string = i18n.t(\"scripts/Global/Menu.js.1\");\n                return;\n            }\n            self.text.string = asset.text;\n        });\n    },\n\n    showReadme: function (event, active) {\n        if (active === undefined) {\n            active = !this.readme.node.active;\n        }\n\n        this.readme.node.active = active;\n        if (active) {\n            this.readme.scrollToTop();\n        }\n\n        // en: fix Collider DebugDraw always displayed on top of the problem.\n        // zh：解决 Collider DebugDraw 一直显示在最上层的问题。\n        var enabledDebugDraw = cc.director.getCollisionManager().enabledDebugDraw;\n        if (this.readme.node.active) {\n            this.showDebugDraw = enabledDebugDraw;\n            cc.director.getCollisionManager().enabledDebugDraw = false;\n        }\n        else {\n            cc.director.getCollisionManager().enabledDebugDraw = this.showDebugDraw;\n        }\n\n        // en: fix Video Player always displayed on top of the problem.\n        // zh：修复 Video Player 一直显示在最上层的问题。\n        var videoPlayer = cc.find('Canvas/VideoPlayer');\n        if (videoPlayer) {\n            videoPlayer.active = !this.readme.node.active;\n        }\n    },\n\n    restart: function () {\n        cc.game.restart();\n    },\n    \n    gc: function () {\n        cc.sys.garbageCollect();\n    }\n});\n"]}