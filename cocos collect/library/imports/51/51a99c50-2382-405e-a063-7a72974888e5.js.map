{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\cases\\dragonbones/assets\\cases\\dragonbones\\DragonBonesCtrl.js"],"names":["cc","runtime","NORMAL_ANIMATION_GROUP","AIM_ANIMATION_GROUP","ATTACK_ANIMATION_GROUP","JUMP_SPEED","NORMALIZE_MOVE_SPEED","MAX_MOVE_SPEED_FRONT","MAX_MOVE_SPEED_BACK","WEAPON_R_LIST","WEAPON_L_LIST","GROUND","G","Class","extends","Component","editor","requireComponent","dragonBones","ArmatureDisplay","properties","touchHandler","default","type","Node","upButton","downButton","leftButton","rightButton","_bullets","_left","_right","_isJumpingA","_isJumpingB","_isSquating","_isAttackingA","_isAttackingB","_weaponRIndex","_weaponLIndex","_faceDir","_aimDir","_moveDir","_aimRadian","_speedX","_speedY","_armature","_armatureDisplay","_weaponR","_weaponL","_aimState","_walkState","_attackState","_target","v2","onLoad","getComponent","armature","addEventListener","EventObject","FADE_IN_COMPLETE","_animationEventHandler","FADE_OUT_COMPLETE","getSlot","displayController","childArmature","FRAME_EVENT","_frameEventHandler","_updateAnimation","on","EventType","TOUCH_START","touches","event","getTouches","touchLoc","getLocation","aim","x","y","attack","TOUCH_END","TOUCH_MOVE","jump","squat","TOUCH_CANCEL","_updateMove","systemEvent","SystemEvent","KEY_DOWN","_keyHandler","keyCode","KEY_UP","isDown","macro","KEY","a","left","d","right","w","up","s","down","q","switchWeaponR","e","switchWeaponL","space","dir","move","animation","fadeIn","isSquating","isAttacking","removeEventListener","length","newWeaponName","buildArmature","node","parent","convertToNodeSpaceAR","update","dt","_updatePosition","_updateAim","_updateAttack","_enterFrameHandler","onDisable","i","bullet","enabled","addBullet","push","splice","animationState","name","firePointBone","getBone","localPoint","global","display","globalPoint","convertToWorldSpace","_fire","firePoint","Math","random","effect","radian","PI","DragonBullet","init","timeScale","minX","visibleRect","width","maxX","scaleX","aimOffsetY","scaleY","atan2","aimDir","AnimationFadeOutMode","SameGroup","weight","abs","invalidUpdate","autoFadeOutTime","fadeTotalTime","addBoneMask","_effect","parentNode","speed","position","cos","sin","thePos","playAnimation","armatureNode","setPosition","rotation","DEG","effectDisplay","addChild","worldPos","convertToWorldSpaceAR","getPosition","height","doClean","removeFromParent"],"mappings":"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","file":"DragonBonesCtrl.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\cases\\dragonbones","sourcesContent":["\nif (!cc.runtime) {\n// runtime not support dragonbones.\n\nvar NORMAL_ANIMATION_GROUP = \"normal\";\nvar AIM_ANIMATION_GROUP = \"aim\";\nvar ATTACK_ANIMATION_GROUP = \"attack\";\nvar JUMP_SPEED = -20;\nvar NORMALIZE_MOVE_SPEED = 3.6;\nvar MAX_MOVE_SPEED_FRONT = NORMALIZE_MOVE_SPEED * 1.4;\nvar MAX_MOVE_SPEED_BACK = NORMALIZE_MOVE_SPEED * 1.0;\nvar WEAPON_R_LIST = [\"weapon_1502b_r\", \"weapon_1005\", \"weapon_1005b\", \"weapon_1005c\", \"weapon_1005d\", \"weapon_1005e\"];\nvar WEAPON_L_LIST = [\"weapon_1502b_l\", \"weapon_1005\", \"weapon_1005b\", \"weapon_1005c\", \"weapon_1005d\"];\nvar GROUND = -200;\nvar G = -0.6;\n\ncc.Class({\n    extends: cc.Component,\n    editor: {\n        requireComponent: dragonBones.ArmatureDisplay\n    },\n\n    properties: {\n        touchHandler : {\n            default: null,\n            type: cc.Node\n        },\n\n        upButton: {\n            default: null,\n            type: cc.Node\n        },\n\n        downButton: {\n            default: null,\n            type: cc.Node\n        },\n\n        leftButton: {\n            default: null,\n            type: cc.Node\n        },\n\n        rightButton: {\n            default: null,\n            type: cc.Node\n        },\n\n        _bullets : [],\n        _left : false,\n        _right : false,\n        _isJumpingA : false,\n        _isJumpingB : false,\n        _isSquating : false,\n        _isAttackingA : false,\n        _isAttackingB : false,\n        _weaponRIndex : 0,\n        _weaponLIndex : 0,\n        _faceDir : 1,\n        _aimDir : 0,\n        _moveDir : 0,\n        _aimRadian : 0,\n        _speedX : 0,\n        _speedY : 0,\n        _armature : null,\n        _armatureDisplay : null,\n        _weaponR : null,\n        _weaponL : null,\n        _aimState : null,\n        _walkState : null,\n        _attackState : null,\n        _target : cc.v2(0, 0),\n    },\n\n    // use this for initialization\n    onLoad: function () {\n        this._armatureDisplay = this.getComponent(dragonBones.ArmatureDisplay);\n        this._armature = this._armatureDisplay.armature();\n\n        this._armatureDisplay.addEventListener(dragonBones.EventObject.FADE_IN_COMPLETE, this._animationEventHandler, this);\n        this._armatureDisplay.addEventListener(dragonBones.EventObject.FADE_OUT_COMPLETE, this._animationEventHandler, this);\n\n        this._armature.getSlot('effects_1').displayController = NORMAL_ANIMATION_GROUP;\n        this._armature.getSlot('effects_2').displayController = NORMAL_ANIMATION_GROUP;\n\n        this._weaponR = this._armature.getSlot('weapon_r').childArmature;\n        this._weaponL = this._armature.getSlot('weapon_l').childArmature;\n        this._weaponR.addEventListener(dragonBones.EventObject.FRAME_EVENT, this._frameEventHandler, this);\n        this._weaponL.addEventListener(dragonBones.EventObject.FRAME_EVENT, this._frameEventHandler, this);\n\n        this._updateAnimation();\n\n        if (this.touchHandler) {\n            // touch events\n            this.touchHandler.on(cc.Node.EventType.TOUCH_START, event => {\n                var touches = event.getTouches();\n                var touchLoc = touches[0].getLocation();\n                this.aim(touchLoc.x, touchLoc.y);\n                this.attack(true);\n            }, this);\n            this.touchHandler.on(cc.Node.EventType.TOUCH_END, event => {\n                this.attack(false);\n            }, this);\n            this.touchHandler.on(cc.Node.EventType.TOUCH_MOVE, event => {\n                var touches = event.getTouches();\n                var touchLoc = touches[0].getLocation();\n                this.aim(touchLoc.x, touchLoc.y);\n            }, this);\n        }\n\n        if (this.upButton) {\n            this.upButton.on(cc.Node.EventType.TOUCH_START, event => {\n                this.jump();\n            }, this);\n        }\n\n        if (this.downButton) {\n            this.downButton.on(cc.Node.EventType.TOUCH_START, event => {\n                this.squat(true);\n            }, this);\n            this.downButton.on(cc.Node.EventType.TOUCH_END, event => {\n                this.squat(false);\n            }, this);\n            this.downButton.on(cc.Node.EventType.TOUCH_CANCEL, event => {\n                this.squat(false);\n            }, this);\n        }\n\n        if (this.leftButton) {\n            this.leftButton.on(cc.Node.EventType.TOUCH_START, event => {\n                this._left = true;\n                this._updateMove(-1);\n            }, this);\n            this.leftButton.on(cc.Node.EventType.TOUCH_END, event => {\n                this._left = false;\n                this._updateMove(-1);\n            }, this);\n            this.leftButton.on(cc.Node.EventType.TOUCH_CANCEL, event => {\n                this._left = false;\n                this._updateMove(-1);\n            }, this);\n        }\n\n        if (this.rightButton) {\n            this.rightButton.on(cc.Node.EventType.TOUCH_START, event => {\n                this._right = true;\n                this._updateMove(1);\n            }, this);\n            this.rightButton.on(cc.Node.EventType.TOUCH_END, event => {\n                this._right = false;\n                this._updateMove(1);\n            }, this);\n            this.rightButton.on(cc.Node.EventType.TOUCH_CANCEL, event => {\n                this._right = false;\n                this._updateMove(1);\n            }, this);\n        }\n\n        // keyboard events\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, function (event) {\n            this._keyHandler(event.keyCode, true);\n        }, this);\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, function (event) {\n            this._keyHandler(event.keyCode, false);\n        }, this);\n    },\n\n    _keyHandler: function(keyCode, isDown) {\n        switch(keyCode) {\n            case cc.macro.KEY.a:\n            case cc.macro.KEY.left:\n                this._left = isDown;\n                this._updateMove(-1);\n                break;\n            case cc.macro.KEY.d:\n            case cc.macro.KEY.right:\n                this._right = isDown;\n                this._updateMove(1);\n                break;\n            case cc.macro.KEY.w:\n            case cc.macro.KEY.up:\n                if (isDown) {\n                    this.jump();\n                }\n                break;\n            case cc.macro.KEY.s:\n            case cc.macro.KEY.down:\n                this.squat(isDown);\n                break;\n            case cc.macro.KEY.q:\n                if (isDown) {\n                    this.switchWeaponR();\n                }\n                break;\n            case cc.macro.KEY.e:\n                if (isDown) {\n                    this.switchWeaponL();\n                }\n                break;\n            case cc.macro.KEY.space:\n                if (isDown) {\n                    this.switchWeaponR();\n                    this.switchWeaponL();\n                }\n                break;\n            default:\n                return;\n        }\n    },\n\n    _updateMove : function (dir) {\n        if (this._left && this._right) {\n            this.move(dir);\n        } else if (this._left) {\n            this.move(-1);\n        } else if (this._right) {\n            this.move(1);\n        } else {\n            this.move(0);\n        }\n    },\n\n    move : function(dir) {\n        if (this._moveDir === dir) {\n            return;\n        }\n\n        this._moveDir = dir;\n        this._updateAnimation();\n    },\n\n    jump : function () {\n        if (this._isJumpingA) {\n            return;\n        }\n\n        this._isJumpingA = true;\n        this._armature.animation.fadeIn(\"jump_1\", -1, -1, 0, NORMAL_ANIMATION_GROUP);\n        this._walkState = null;\n    },\n\n    squat : function(isSquating) {\n        if (this._isSquating === isSquating) {\n            return;\n        }\n\n        this._isSquating = isSquating;\n        this._updateAnimation();\n    },\n\n    attack : function (isAttacking) {\n        if (this._isAttackingA == isAttacking) {\n            return;\n        }\n\n        this._isAttackingA = isAttacking;\n    },\n\n    switchWeaponL : function() {\n        this._weaponL.removeEventListener(dragonBones.EventObject.FRAME_EVENT, this._frameEventHandler, this);\n\n        this._weaponLIndex = (this._weaponLIndex + 1) % WEAPON_L_LIST.length;\n        var newWeaponName = WEAPON_L_LIST[this._weaponLIndex];\n        this._weaponL = this._armatureDisplay.buildArmature(newWeaponName);\n        this._armature.getSlot('weapon_l').childArmature = this._weaponL.armature();\n\n        this._weaponL.addEventListener(dragonBones.EventObject.FRAME_EVENT, this._frameEventHandler, this);\n    },\n\n    switchWeaponR : function() {\n        this._weaponR.removeEventListener(dragonBones.EventObject.FRAME_EVENT, this._frameEventHandler, this);\n\n        this._weaponRIndex = (this._weaponRIndex + 1) % WEAPON_R_LIST.length;\n        var newWeaponName = WEAPON_R_LIST[this._weaponRIndex];\n        this._weaponR = this._armatureDisplay.buildArmature(newWeaponName);\n        this._armature.getSlot('weapon_r').childArmature = this._weaponR.armature();\n\n        this._weaponR.addEventListener(dragonBones.EventObject.FRAME_EVENT, this._frameEventHandler, this);\n    },\n\n    aim : function(x, y) {\n        if (this._aimDir === 0) {\n            this._aimDir = 10;\n        }\n\n        this._target = this.node.parent.convertToNodeSpaceAR(cc.v2(x, y));\n    },\n\n    update : function (dt) {\n        this._updatePosition();\n        this._updateAim();\n        this._updateAttack();\n        this._enterFrameHandler(dt);\n    },\n\n    onDisable : function() {\n        // clean the bullets\n        for (var i = this._bullets.length - 1; i >= 0; i--)\n        {\n            var bullet = this._bullets[i];\n            bullet.enabled = false;\n        }\n        this._bullets = [];\n    },\n\n    addBullet : function(bullet) {\n        this._bullets.push(bullet);\n    },\n\n    _enterFrameHandler : function (dt) {\n        for (var i = this._bullets.length - 1; i >= 0; i--)\n        {\n            var bullet = this._bullets[i];\n            if (bullet.update())\n            {\n                this._bullets.splice(i, 1);\n            }\n        }\n    },\n\n    _animationEventHandler: function (event) {\n        if (event.type === dragonBones.EventObject.FADE_IN_COMPLETE) {\n            if (event.animationState.name === \"jump_1\") {\n                this._isJumpingB = true;\n                this._speedY = -JUMP_SPEED;\n                this._armature.animation.fadeIn(\"jump_2\", -1, -1, 0, NORMAL_ANIMATION_GROUP);\n            } else if (event.animationState.name === \"jump_4\") {\n                this._updateAnimation();\n            }\n        }\n        else if (event.type === dragonBones.EventObject.FADE_OUT_COMPLETE) {\n            if (event.animationState.name === \"attack_01\") {\n                this._isAttackingB = false;\n                this._attackState = null;\n            }\n        }\n    },\n\n    _frameEventHandler : function (event) {\n        if (event.name === \"onFire\") {\n            var firePointBone = event.armature.getBone(\"firePoint\");\n            var localPoint = cc.v2(firePointBone.global.x, -firePointBone.global.y);\n\n            var display = event.armature.display;\n            var globalPoint = display.node.convertToWorldSpace(localPoint);\n\n            this._fire(globalPoint);\n        }\n    },\n\n    _fire : function (firePoint) {\n        firePoint.x += Math.random() * 2 - 1;\n        firePoint.y += Math.random() * 2 - 1;\n\n        var armature = this._armatureDisplay.buildArmature(\"bullet_01\");\n        var effect = this._armatureDisplay.buildArmature(\"fireEffect_01\");\n        var radian = this._faceDir < 0 ? Math.PI - this._aimRadian : this._aimRadian;\n        var bullet = new DragonBullet();\n        bullet.init(this.node.parent, armature, effect, radian + Math.random() * 0.02 - 0.01, 40, firePoint);\n        this.addBullet(bullet);\n    },\n\n    _updateAnimation : function() {\n        if (this._isJumpingA) {\n            return;\n        }\n\n        if (this._isSquating) {\n            this._speedX = 0;\n            this._armature.animation.fadeIn(\"squat\", -1, -1, 0, NORMAL_ANIMATION_GROUP);\n            this._walkState = null;\n            return;\n        }\n\n        if (this._moveDir === 0) {\n            this._speedX = 0;\n            this._armature.animation.fadeIn(\"idle\", -1, -1, 0, NORMAL_ANIMATION_GROUP);\n            this._walkState = null;\n        } else {\n            if (!this._walkState) {\n                this._walkState = this._armature.animation.fadeIn(\"walk\", -1, -1, 0, NORMAL_ANIMATION_GROUP);\n            }\n\n            if (this._moveDir * this._faceDir > 0) {\n                this._walkState.timeScale = MAX_MOVE_SPEED_FRONT / NORMALIZE_MOVE_SPEED;\n            } else {\n                this._walkState.timeScale = -MAX_MOVE_SPEED_BACK / NORMALIZE_MOVE_SPEED;\n            }\n\n            if (this._moveDir * this._faceDir > 0) {\n                this._speedX = MAX_MOVE_SPEED_FRONT * this._faceDir;\n            } else {\n                this._speedX = -MAX_MOVE_SPEED_BACK * this._faceDir;\n            }\n        }\n    },\n\n    _updatePosition : function() {\n        if (this._speedX !== 0) {\n            this.node.x += this._speedX;\n            var minX = -cc.visibleRect.width / 2;\n            var maxX = cc.visibleRect.width / 2;\n            if (this.node.x < minX) {\n                this.node.x = minX;\n            } else if (this.node.x > maxX) {\n                this.node.x = maxX;\n            }\n        }\n\n        if (this._speedY != 0) {\n            if (this._speedY > 5 && this._speedY + G <= 5) {\n                this._armature.animation.fadeIn(\"jump_3\", -1, -1, 0, NORMAL_ANIMATION_GROUP);\n            }\n\n            this._speedY += G;\n\n            this.node.y += this._speedY;\n            if (this.node.y < GROUND) {\n                this.node.y = GROUND;\n                this._isJumpingA = false;\n                this._isJumpingB = false;\n                this._speedY = 0;\n                this._speedX = 0;\n                this._armature.animation.fadeIn(\"jump_4\", -1, -1, 0, NORMAL_ANIMATION_GROUP);\n                if (this._isSquating || this._moveDir) {\n                    this._updateAnimation();\n                }\n            }\n        }\n    },\n\n    _updateAim : function () {\n        if (this._aimDir === 0) {\n            return;\n        }\n\n        this._faceDir = this._target.x > this.node.x ? 1 : -1;\n        if (this.node.scaleX * this._faceDir < 0) {\n            this.node.scaleX *= -1;\n            if (this._moveDir) {\n                this._updateAnimation();\n            }\n        }\n\n        var aimOffsetY = this._armature.getBone(\"chest\").global.y * this.node.scaleY;\n\n        if (this._faceDir > 0) {\n            this._aimRadian = Math.atan2(-(this._target.y - this.node.y + aimOffsetY), this._target.x - this.node.x);\n        } else {\n            this._aimRadian = Math.PI - Math.atan2(-(this._target.y - this.node.y + aimOffsetY), this._target.x - this.node.x);\n            if (this._aimRadian > Math.PI) {\n                this._aimRadian -= Math.PI * 2;\n            }\n        }\n\n        let aimDir = 0;\n        if (this._aimRadian > 0) {\n            aimDir = -1;\n        } else {\n            aimDir = 1;\n        }\n\n        if (this._aimDir != aimDir) {\n            this._aimDir = aimDir;\n\n            // Animation mixing.\n            if (this._aimDir >= 0) {\n                this._aimState = this._armature.animation.fadeIn(\n                    \"aimUp\", 0, 1,\n                    0, AIM_ANIMATION_GROUP, dragonBones.AnimationFadeOutMode.SameGroup\n                );\n            } else {\n                this._aimState = this._armature.animation.fadeIn(\n                    \"aimDown\", 0, 1,\n                    0, AIM_ANIMATION_GROUP, dragonBones.AnimationFadeOutMode.SameGroup\n                );\n            }\n\n            // Add bone mask.\n            //_aimState.addBoneMask(\"pelvis\");\n        }\n\n        this._aimState.weight = Math.abs(this._aimRadian / Math.PI * 2);\n\n        //_armature.invalidUpdate(\"pelvis\"); // Only update bone mask.\n        this._armature.invalidUpdate();\n    },\n\n    _updateAttack : function() {\n        if (!this._isAttackingA || this._isAttackingB) {\n            return;\n        }\n\n        this._isAttackingB = true;\n\n        // Animation mixing.\n        this._attackState = this._armature.animation.fadeIn(\n            \"attack_01\", -1, -1,\n            0, ATTACK_ANIMATION_GROUP, dragonBones.AnimationFadeOutMode.SameGroup\n        );\n\n        this._attackState.autoFadeOutTime = this._attackState.fadeTotalTime;\n        this._attackState.addBoneMask(\"pelvis\");\n    }\n});\n\n\nvar DragonBullet = cc.Class({\n    name: 'DragonBullet',\n    _speedX : 0,\n    _speedY : 0,\n\n    _armature : null,\n    _armatureDisplay : null,\n    _effect : null,\n\n    init : function (parentNode, armature, effect, radian, speed, position) {\n        this._speedX = Math.cos(radian) * speed;\n        this._speedY = -Math.sin(radian) * speed;\n        var thePos = parentNode.convertToNodeSpaceAR(position);\n\n        armature.playAnimation(\"idle\");\n        \n        let armatureNode = armature.node;\n        armatureNode.setPosition(thePos);\n        armatureNode.rotation = radian * cc.macro.DEG;\n\n        this._armature = armature;\n        \n        if (effect) {\n            this._effect = effect;\n            var effectDisplay = this._effect.node;\n            effectDisplay.rotation = radian * cc.macro.DEG;\n            effectDisplay.setPosition(thePos);\n            effectDisplay.scaleX = 1 + Math.random() * 1;\n            effectDisplay.scaleY = 1 + Math.random() * 0.5;\n            if (Math.random() < 0.5) {\n                effectDisplay.scaleY *= -1;\n            }\n\n            this._effect.playAnimation(\"idle\");\n\n            parentNode.addChild(effectDisplay);\n        }\n\n        parentNode.addChild(armatureNode);\n    },\n\n    update : function() {\n        let armatureNode = this._armature.node;\n\n        armatureNode.x += this._speedX;\n        armatureNode.y += this._speedY;\n\n        var worldPos = armatureNode.parent.convertToWorldSpaceAR(armatureNode.getPosition());\n        if (\n            worldPos.x < -100 || worldPos.x >= cc.visibleRect.width + 100 ||\n            worldPos.y < -100 || worldPos.y >= cc.visibleRect.height + 100\n        ) {\n            this.doClean();\n            return true;\n        }\n\n        return false;\n    },\n\n    onDisable : function () {\n        this.doClean();\n    },\n\n    doClean : function() {\n        this._armature.node.removeFromParent();\n\n        if (this._effect) {\n            this._effect.node.removeFromParent();\n        }\n    }\n});\n} // end of !cc.runtime\n"]}