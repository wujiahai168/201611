{"version":3,"sources":["..\\..\\..\\..\\..\\..\\..\\assets\\cases\\03_gameplay\\01_player_control\\OnTouchCtrl/assets\\cases\\03_gameplay\\01_player_control\\OnTouchCtrl\\OnTouchCtrl.js"],"names":["i18n","require","cc","Class","extends","Component","properties","canvas","Node","touchLocationDisplay","default","type","Label","follower","followSpeed","onLoad","self","moveToPos","v2","isMoving","on","EventType","TOUCH_START","event","touches","getTouches","touchLoc","getLocation","parent","convertToNodeSpaceAR","textKey","t","Math","floor","x","y","node","TOUCH_MOVE","TOUCH_END","update","dt","oldPos","position","direction","sub","normalize","newPos","add","mul","setPosition"],"mappings":";;;;;;AAAA,IAAMA,OAAOC,QAAQ,MAAR,CAAb;;AAEAC,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,gBAAQL,GAAGM,IADH;AAERC,8BAAsB;AAClBC,qBAAS,IADS;AAElBC,kBAAMT,GAAGU;AAFS,SAFd;AAMRC,kBAAU;AACNH,qBAAS,IADH;AAENC,kBAAMT,GAAGM;AAFH,SANF;AAURM,qBAAa;AAVL,KAHP;;AAgBL;AACAC,YAAQ,kBAAY;AAChB,YAAIC,OAAO,IAAX;AACAA,aAAKC,SAAL,GAAiBf,GAAGgB,EAAH,CAAM,CAAN,EAAS,CAAT,CAAjB;AACAF,aAAKG,QAAL,GAAgB,KAAhB;AACAH,aAAKT,MAAL,CAAYa,EAAZ,CAAelB,GAAGM,IAAH,CAAQa,SAAR,CAAkBC,WAAjC,EAA8C,UAAUC,KAAV,EAAiB;AAC3D,gBAAIC,UAAUD,MAAME,UAAN,EAAd;AACA,gBAAIC,WAAWF,QAAQ,CAAR,EAAWG,WAAX,EAAf;AACAX,iBAAKG,QAAL,GAAgB,IAAhB;AACAH,iBAAKC,SAAL,GAAiBD,KAAKH,QAAL,CAAce,MAAd,CAAqBC,oBAArB,CAA0CH,QAA1C,CAAjB;AACAV,iBAAKP,oBAAL,CAA0BqB,OAA1B,GAAoC9B,KAAK+B,CAAL,CAAO,yDAAP,IAAoEC,KAAKC,KAAL,CAAWP,SAASQ,CAApB,CAApE,GAA6F,IAA7F,GAAoGF,KAAKC,KAAL,CAAWP,SAASS,CAApB,CAApG,GAA6H,GAAjK;AACH,SAND,EAMGnB,KAAKoB,IANR;AAOApB,aAAKT,MAAL,CAAYa,EAAZ,CAAelB,GAAGM,IAAH,CAAQa,SAAR,CAAkBgB,UAAjC,EAA6C,UAAUd,KAAV,EAAiB;AAC1D,gBAAIC,UAAUD,MAAME,UAAN,EAAd;AACA,gBAAIC,WAAWF,QAAQ,CAAR,EAAWG,WAAX,EAAf;AACAX,iBAAKC,SAAL,GAAiBD,KAAKH,QAAL,CAAce,MAAd,CAAqBC,oBAArB,CAA0CH,QAA1C,CAAjB;AACAV,iBAAKP,oBAAL,CAA0BqB,OAA1B,GAAoC9B,KAAK+B,CAAL,CAAO,yDAAP,IAAoEC,KAAKC,KAAL,CAAWP,SAASQ,CAApB,CAApE,GAA6F,IAA7F,GAAoGF,KAAKC,KAAL,CAAWP,SAASS,CAApB,CAApG,GAA6H,GAAjK;AACH,SALD,EAKGnB,KAAKoB,IALR;AAMApB,aAAKT,MAAL,CAAYa,EAAZ,CAAelB,GAAGM,IAAH,CAAQa,SAAR,CAAkBiB,SAAjC,EAA4C,UAAUf,KAAV,EAAiB;AACzDP,iBAAKG,QAAL,GAAgB,KAAhB,CADyD,CAClC;AAC1B,SAFD,EAEGH,KAAKoB,IAFR;AAGH,KArCI;;AAuCL;AACAG,YAAQ,gBAAUC,EAAV,EAAc;AAClB,YAAI,CAAC,KAAKrB,QAAV,EAAoB;AACpB,YAAIsB,SAAS,KAAK5B,QAAL,CAAc6B,QAA3B;AACA;AACA,YAAIC,YAAY,KAAK1B,SAAL,CAAe2B,GAAf,CAAmBH,MAAnB,EAA2BI,SAA3B,EAAhB;AACA;AACA,YAAIC,SAASL,OAAOM,GAAP,CAAWJ,UAAUK,GAAV,CAAc,KAAKlC,WAAL,GAAmB0B,EAAjC,CAAX,CAAb;AACA;AACA,aAAK3B,QAAL,CAAcoC,WAAd,CAA0BH,MAA1B;AACH;AAjDI,CAAT","file":"OnTouchCtrl.js","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\cases\\03_gameplay\\01_player_control\\OnTouchCtrl","sourcesContent":["const i18n = require('i18n');\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        canvas: cc.Node,\n        touchLocationDisplay: {\n            default: null,\n            type: cc.Label\n        },\n        follower: {\n            default: null,\n            type: cc.Node\n        },\n        followSpeed: 200\n    },\n\n    // use this for initialization\n    onLoad: function () {\n        var self = this;\n        self.moveToPos = cc.v2(0, 0);\n        self.isMoving = false;\n        self.canvas.on(cc.Node.EventType.TOUCH_START, function (event) {\n            var touches = event.getTouches();\n            var touchLoc = touches[0].getLocation();\n            self.isMoving = true;\n            self.moveToPos = self.follower.parent.convertToNodeSpaceAR(touchLoc);\n            self.touchLocationDisplay.textKey = i18n.t(\"cases/03_gameplay/01_player_control/On/OnTouchCtrl.js.1\") + Math.floor(touchLoc.x) + ', ' + Math.floor(touchLoc.y) + ')';\n        }, self.node);\n        self.canvas.on(cc.Node.EventType.TOUCH_MOVE, function (event) {\n            var touches = event.getTouches();\n            var touchLoc = touches[0].getLocation();\n            self.moveToPos = self.follower.parent.convertToNodeSpaceAR(touchLoc);\n            self.touchLocationDisplay.textKey = i18n.t(\"cases/03_gameplay/01_player_control/On/OnTouchCtrl.js.1\") + Math.floor(touchLoc.x) + ', ' + Math.floor(touchLoc.y) + ')';\n        }, self.node);\n        self.canvas.on(cc.Node.EventType.TOUCH_END, function (event) {\n            self.isMoving = false; // when touch ended, stop moving\n        }, self.node);\n    },\n\n    // called every frame\n    update: function (dt) {\n        if (!this.isMoving) return;\n        var oldPos = this.follower.position;\n        // get move direction\n        var direction = this.moveToPos.sub(oldPos).normalize();\n        // multiply direction with distance to get new position\n        var newPos = oldPos.add(direction.mul(this.followSpeed * dt));\n        // set new position\n        this.follower.setPosition(newPos);\n    }\n});\n"]}