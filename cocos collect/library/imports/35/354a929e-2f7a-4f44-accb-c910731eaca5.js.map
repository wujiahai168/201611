{"version":3,"sources":["..\\..\\..\\..\\..\\..\\..\\assets\\cases\\05_scripting\\11_network\\downloader-native/assets\\cases\\05_scripting\\11_network\\downloader-native\\DownloaderCtrl.js"],"names":["cc","Class","extends","Component","properties","label","Label","sprite","Sprite","imgUrl","txtUrl","tempImgUrl","audioUrl","_downloader","_imgTask","_txtTask","_audioTask","_storagePath","_inited","onLoad","CC_JSB","string","jsb","Downloader","setOnFileTaskSuccess","onSucceed","bind","setOnTaskProgress","onProgress","setOnTaskError","onError","fileUtils","getWritablePath","createDirectory","_audioID","task","audioEngine","stop","requestURL","loader","load","storagePath","err","tex","spriteFrame","SpriteFrame","node","active","content","getStringFromFile","substr","clip","play","bytesReceived","totalBytesReceived","totalBytesExpected","errorCode","errorCodeInternal","errorStr","downloadImg","createDownloadFileTask","loadImg","error","console","log","downloadTxt","downloadAudio","onDisable"],"mappings":"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","file":"DownloaderCtrl.js","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\cases\\05_scripting\\11_network\\downloader-native","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        label: cc.Label,\n        sprite: cc.Sprite,\n        imgUrl: \"http://www.cocos.com/wp-content/themes/cocos/img/download1.png\",\n        txtUrl: \"https://raw.githubusercontent.com/cocos-creator/tutorial-dark-slash/master/LICENSE.md\",\n        tempImgUrl: \"http://www.cocos.com/wp-content/uploads/2018/03/%E9%BB%98%E8%AE%A4%E6%A0%87%E9%A2%98_%E5%85%AC%E4%BC%97%E5%8F%B7%E5%BA%95%E9%83%A8%E4%BA%8C%E7%BB%B4%E7%A0%81_2018.03.08.png\",\n        audioUrl: \"http://tools.itharbors.com/christmas/res/sounds/ss.mp3\",\n        _downloader: null,\n        _imgTask: null,\n        _txtTask: null,\n        _audioTask: null,\n        _storagePath: \"\",\n        _inited: false\n    },\n\n    // use this for initialization\n    onLoad () {\n        if (!CC_JSB) {\n            this.label.string = 'Downloader is a NATIVE ONLY feature.';\n            return;\n        }\n\n        this._downloader = new jsb.Downloader();\n        this._downloader.setOnFileTaskSuccess(this.onSucceed.bind(this));\n        this._downloader.setOnTaskProgress(this.onProgress.bind(this));\n        this._downloader.setOnTaskError(this.onError.bind(this));\n        this._storagePath = jsb.fileUtils.getWritablePath() + '/example-cases/downloader/';\n        this._inited = jsb.fileUtils.createDirectory(this._storagePath);\n        if (!this._inited) {\n            this.label.string = 'Failed to create storage path, downloader won\\'t work correctly';\n        }\n        this._audioID = -1;\n    },\n\n    onSucceed (task) {\n        if (this._audioID !== -1) {\n            cc.audioEngine.stop(this._audioID);\n        }\n        switch (task.requestURL) {\n        case this.imgUrl:\n            cc.loader.load(task.storagePath, (err, tex) => {\n                this.sprite.spriteFrame = new cc.SpriteFrame(tex);\n                this.sprite.node.active = true;\n                this.label.node.active = false;\n            });\n            break;\n        case this.txtUrl:\n            let content = jsb.fileUtils.getStringFromFile(task.storagePath);\n            this.sprite.node.active = false;\n            this.label.node.active = true;\n            this.label.string = content.substr(0, 350);\n            break;\n        case this.audioUrl:\n            this.sprite.node.active = false;\n            this.label.node.active = true;\n            this.label.string = 'Audio Download Complete.';\n            cc.loader.load(task.storagePath, (err, clip) => {\n                this._audioID = cc.audioEngine.play(clip);\n            });\n        }\n    },\n\n    onProgress (task, bytesReceived, totalBytesReceived, totalBytesExpected) {\n\n    },\n\n    onError (task, errorCode, errorCodeInternal, errorStr) {\n        this.sprite.node.active = false;\n        this.label.node.active = true;\n        this.label.string = 'Failed to download file (' + task.requestURL + '): ' + errorStr + '(' + errorCode + ')';\n    },\n\n    downloadImg () {\n        if (!this.imgUrl || !this._inited) {\n            return;\n        }\n        this.sprite.node.active = false;\n        this.label.node.active = true;\n        this.label.string = 'Downloading image';\n        this._imgTask = this._downloader.createDownloadFileTask(this.imgUrl, this._storagePath + 'download1.png');\n    },\n\n    loadImg () {\n        if (!this.tempImgUrl || !this._inited) {\n            return;\n        }\n        cc.loader.load(this.tempImgUrl, (error, tex) => {\n            if (error) {\n                console.log(\"Load remote image failed: \" + error);\n            }\n            else {\n                this.sprite.spriteFrame = new cc.SpriteFrame(tex);\n                this.sprite.node.active = true;\n                this.label.node.active = false;\n                cc.audioEngine.stop(this._audioID);\n            }\n        });\n    },\n\n    downloadTxt () {\n        if (!this.txtUrl || !this._inited) {\n            return;\n        }\n        this.label.node.active = true;\n        this.sprite.node.active = false;\n        this.label.string = 'Downloading Txt';\n        this._txtTask = this._downloader.createDownloadFileTask(this.txtUrl, this._storagePath + 'imagine.txt');\n    },\n\n    downloadAudio () {\n        if (!this.audioUrl || !this._inited) {\n            return;\n        }\n        this.sprite.node.active = false;\n        this.label.node.active = true;\n        this.label.string = 'Downloading Audio';\n        this._audioTask = this._downloader.createDownloadFileTask(this.audioUrl, this._storagePath + 'audioTest.mp3');\n    },\n\n    onDisable () {\n        cc.audioEngine.stop(this._audioID);\n    }\n\n});\n"]}