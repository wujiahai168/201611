{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\cases\\05_scripting\\11_network/assets\\cases\\05_scripting\\11_network\\NetworkCtrl.js"],"names":["i18n","require","cc","Class","extends","Component","properties","xhr","Label","xhrAB","xhrTimeout","websocket","socketIO","xhrResp","xhrABResp","xhrTimeoutResp","websocketResp","socketIOResp","onLoad","_wsiSendBinary","_xhrXHR","_xhrHRAB","_xhrXHRTimeout","string","t","sendXHR","sendXHRAB","sendXHRTimeout","prepareWebSocket","sendSocketIO","onDisable","wsiSendBinary","onopen","onmessage","onerror","onclose","rmXhrEventListener","loader","getXMLHttpRequest","streamXHREventsToLabel","open","sys","isNative","setRequestHeader","timeout","send","Uint8Array","XMLHttpRequest","self","websocketLabel","respLabel","WebSocket","binaryType","evt","textKey","binary","Uint16Array","data","binaryStr","str","i","length","hexChar","toString","toUpperCase","String","fromCharCode","scheduleOnce","sendWebSocketBinary","sender","readyState","OPEN","buf","arrData","charCodeAt","buffer","warningStr","testevent","msg","tag","message","disconnection","io","error","sioclient","connect","_sioClient","on","bind","log","eventLabel","label","method","responseHandler","handler","response","substring","eventLabelOrigin","forEach","eventname","onreadystatechange","status","responseText"],"mappings":"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","file":"NetworkCtrl.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\cases\\05_scripting\\11_network","sourcesContent":["const i18n = require('i18n');\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        xhr: cc.Label,\n        xhrAB: cc.Label,\n        xhrTimeout: cc.Label,\n        websocket: cc.Label,\n        socketIO: cc.Label,\n        \n        xhrResp: cc.Label,\n        xhrABResp: cc.Label,\n        xhrTimeoutResp: cc.Label,\n        websocketResp: cc.Label,\n        socketIOResp: cc.Label\n    },\n\n    // use this for initialization\n    onLoad: function () {\n        this._wsiSendBinary = null;\n        this._xhrXHR = null;\n        this._xhrHRAB = null;\n        this._xhrXHRTimeout = null;\n        \n        this.xhrResp.string = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.1\");\n        this.xhrABResp.string = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.2\");\n        this.xhrTimeoutResp.string = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.2\");\n        this.websocketResp.string = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.3\");\n        this.socketIOResp.string = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.4\");\n        \n        this.sendXHR();\n        this.sendXHRAB();\n        this.sendXHRTimeout();\n        this.prepareWebSocket();\n        this.sendSocketIO();\n    },\n\n    onDisable: function () {\n        var wsiSendBinary = this._wsiSendBinary;\n        if (wsiSendBinary) {\n            wsiSendBinary.onopen = null;\n            wsiSendBinary.onmessage = null;\n            wsiSendBinary.onerror = null;\n            wsiSendBinary.onclose = null;\n        }\n        this.rmXhrEventListener(this._xhrXHR);\n        this.rmXhrEventListener(this._xhrHRAB);\n        this.rmXhrEventListener(this._xhrXHRTimeout);\n    },\n    \n    sendXHR: function () {\n        var xhr = cc.loader.getXMLHttpRequest();\n        this.streamXHREventsToLabel(xhr, this.xhr, this.xhrResp, 'GET');\n\n        xhr.open(\"GET\", \"https://httpbin.org/get?show_env=1\", true);\n        if (cc.sys.isNative) {\n            xhr.setRequestHeader(\"Accept-Encoding\",\"gzip,deflate\");\n        }\n\n        // note: In Internet Explorer, the timeout property may be set only after calling the open()\n        // method and before calling the send() method.\n        xhr.timeout = 10000;// 10 seconds for timeout\n\n        xhr.send();\n        this._xhrXHR = xhr;\n    },\n    \n    sendXHRAB: function () {\n        var xhr = cc.loader.getXMLHttpRequest();\n        this.streamXHREventsToLabel(xhr, this.xhrAB, this.xhrABResp, \"POST\");\n\n        xhr.open(\"POST\", \"https://httpbin.org/post\");\n        //set Content-type \"text/plain\" to post ArrayBuffer or ArrayBufferView\n        xhr.setRequestHeader(\"Content-Type\",\"text/plain\");\n        // Uint8Array is an ArrayBufferView\n        xhr.send(new Uint8Array([1,2,3,4,5]));\n        this._xhrHRAB = xhr;\n    },\n    \n    sendXHRTimeout: function () {\n        var xhr = new XMLHttpRequest();\n        this.streamXHREventsToLabel(xhr, this.xhrTimeout, this.xhrTimeoutResp, 'GET');\n\n        xhr.open(\"GET\", \"https://192.168.22.222\", true);\n\n        // note: In Internet Explorer, the timeout property may be set only after calling the open()\n        // method and before calling the send() method.\n        xhr.timeout = 5000;// 5 seconds for timeout\n        xhr.send();\n        this._xhrXHRTimeout = xhr;\n    },\n    \n    prepareWebSocket: function () {\n        var self = this;\n        var websocketLabel = this.websocket;\n        var respLabel = this.websocketResp;\n        this._wsiSendBinary = new WebSocket(\"ws://echo.websocket.org\");\n        this._wsiSendBinary.binaryType = \"arraybuffer\";\n        this._wsiSendBinary.onopen = function(evt) {\n            websocketLabel.textKey = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.5\");\n        };\n\n        this._wsiSendBinary.onmessage = function(evt) {\n            var binary = new Uint16Array(evt.data);\n            var binaryStr = 'response bin msg: ';\n\n            var str = '';\n            for (var i = 0; i < binary.length; i++) {\n                if (binary[i] === 0)\n                {\n                    str += \"\\'\\\\0\\'\";\n                }\n                else\n                {\n                    var hexChar = '0x' + binary[i].toString('16').toUpperCase();\n                    str += String.fromCharCode(hexChar);\n                }\n            }\n\n            binaryStr += str;\n            respLabel.string = binaryStr;\n            websocketLabel.textKey = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.6\");\n        };\n\n        this._wsiSendBinary.onerror = function(evt) {\n            websocketLabel.textKey = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.7\");\n        };\n\n        this._wsiSendBinary.onclose = function(evt) {\n            websocketLabel.textKey = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.8\");\n            // After close, it's no longer possible to use it again, \n            // if you want to send another request, you need to create a new websocket instance\n            self._wsiSendBinary = null;\n        };\n        \n        this.scheduleOnce(this.sendWebSocketBinary, 1);\n    },\n\n    sendWebSocketBinary: function(sender) {\n        if (!this._wsiSendBinary) { return; }\n        if (this._wsiSendBinary.readyState === WebSocket.OPEN)\n        {\n            this.websocket.textKey = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.9\");\n            var buf = \"Hello WebSocket中文,\\0 I'm\\0 a\\0 binary\\0 message\\0.\";\n            \n            var arrData = new Uint16Array(buf.length);\n            for (var i = 0; i < buf.length; i++) {\n                arrData[i] = buf.charCodeAt(i);\n            }\n            \n            this._wsiSendBinary.send(arrData.buffer);\n        }\n        else\n        {\n            var warningStr = \"send binary websocket instance wasn't ready...\";\n            this.websocket.textKey = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.10\") + warningStr;\n            this.scheduleOnce(function () {\n                this.sendWebSocketBinary();\n            }, 1);\n        }\n    },\n\n    // Socket IO callbacks for testing\n    testevent: function(data) {\n        if (!this.socketIO) { return; }\n\n        var msg = this.tag + \" says 'testevent' with data: \" + data;\n        this.socketIO.textKey = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.11\") + msg;\n    },\n\n    message: function(data) {\n        if (!this.socketIO) { return; }\n\n        var msg = this.tag + \" received message: \" + data;\n        this.socketIOResp.string = msg;\n    },\n\n    disconnection: function() {\n        if (!this.socketIO) { return; }\n\n        var msg = this.tag + \" disconnected!\";\n        this.socketIO.textKey = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.12\") + msg;\n    },\n    \n    sendSocketIO: function () {\n        var self = this;\n        if (typeof io === 'undefined') {\n            cc.error('You should import the socket.io.js as a plugin!');\n            return;\n        }\n        //create a client by using this static method, url does not need to contain the protocol\n        var sioclient = io.connect(\"ws://tools.itharbors.com:4000\", {\"force new connection\" : true});\n        this._sioClient = sioclient;\n\n        //if you need to track multiple sockets it is best to store them with tags in your own array for now\n        this.tag = sioclient.tag = \"Test Client\";\n        \n        //register event callbacks\n        //this is an example of a handler declared inline\n        sioclient.on(\"connect\", function() {\n            if (!self.socketIO) { return; }\n\n            var msg = sioclient.tag + \" Connected!\";\n            self.socketIO.textKey = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.13\") + msg;\n\n            // Send message after connection\n            self._sioClient.send(\"Hello Socket.IO!\");\n        });\n\n        //example of a handler that is shared between multiple clients\n        sioclient.on(\"message\", this.message.bind(this));\n\n        sioclient.on(\"echotest\", function (data) {\n            if (!self.socketIO) { return; }\n\n            cc.log(\"echotest 'on' callback fired!\");\n            var msg = self.tag + \" says 'echotest' with data: \" + data;\n            self.socketIO.textKey = i18n.t(\"cases/05_scripting/11_network/NetworkCtrl.js.14\") + msg;\n        });\n\n        sioclient.on(\"testevent\", this.testevent.bind(this));\n\n        sioclient.on(\"disconnect\", this.disconnection.bind(this));\n    },\n    \n    streamXHREventsToLabel: function ( xhr, eventLabel, label, method, responseHandler ) {\n        var handler = responseHandler || function (response) {\n            return method + \" Response (30 chars): \" + response.substring(0, 30) + \"...\";\n        };\n        \n        var eventLabelOrigin = eventLabel.string;\n        // Simple events\n        ['loadstart', 'abort', 'error', 'load', 'loadend', 'timeout'].forEach(function (eventname) {\n            xhr[\"on\" + eventname] = function () {\n                eventLabel.string = eventLabelOrigin + \"\\nEvent : \" + eventname;\n                if (eventname === 'timeout') {\n                    label.string = '(timeout)';\n                }\n            };\n        });\n    \n        // Special event\n        xhr.onreadystatechange = function () {\n            if (xhr.readyState === 4 && xhr.status >= 200) {\n                label.string = handler(xhr.responseText);\n            }\n        };\n    },\n\n    rmXhrEventListener: function (xhr) {\n        if (!xhr) {\n            return;\n        }\n        ['loadstart', 'abort', 'error', 'load', 'loadend', 'timeout'].forEach(function (eventname) {\n            xhr[\"on\" + eventname] = null;\n        });\n        xhr.onreadystatechange = null;\n    }\n});\n"]}